---
// Enhanced Navigation component with modern features
---

<nav class="fixed top-0 left-0 right-0 bg-white/80 backdrop-blur-xl border-b border-gray-200/50 shadow-sm z-50 transition-all duration-300" id="navbar" role="navigation" aria-label="Nawigacja główna">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16 lg:h-18">
      
      <!-- Logo with modern solid design -->
      <a href="#hero" class="flex items-center group transition-transform duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-lg p-2 -m-2" >
        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 from-[-25%] to-125% rounded-xl flex items-center justify-center mr-3 shadow-lg group-hover:shadow-xl group-hover:bg-blue-700 transition-all duration-300 ring-2 ring-blue-500/20 group-hover:ring-blue-500/40">
          <span class="text-white font-bold text-base drop-shadow-sm" aria-hidden="true">AD</span>
        </div>
        <div class="flex flex-col">
          <span class="font-bold text-gray-900 text-lg group-hover:text-blue-600 transition-colors duration-200">Adrian</span>
          <span class="text-xs text-gray-600 font-medium group-hover:text-blue-500 transition-colors duration-200">Frontend Developer</span>
        </div>
        <!-- Enhanced status indicator -->
        <div class="ml-3 relative">
          <div class="w-2 h-2 bg-emerald-400 rounded-full shadow-sm ring-2 ring-emerald-100" aria-hidden="true" title="Status: Online"></div>
          <div class="absolute inset-0 w-2 h-2 bg-emerald-400 rounded-full animate-ping opacity-20" aria-hidden="true"></div>
        </div>
      </a>

      <!-- Desktop Navigation with improved UX -->
      <div class="hidden lg:flex items-center space-x-1" role="menubar">
        <!-- Clean progress indicator -->
        <div class="flex items-center mr-4" aria-hidden="true">
          <div class="w-20 h-1.5 bg-gray-200/60 rounded-full overflow-hidden shadow-inner">
            <div id="scroll-progress" class="h-full bg-gradient-to-r from-blue-600 to-purple-600 rounded-full transition-all duration-200 w-0 shadow-sm"></div>
          </div>
        </div>

        <a href="#about" class="nav-link px-4 py-2.5 rounded-xl text-gray-700 hover:text-blue-600 hover:bg-blue-50 font-medium transition-all duration-200 flex items-center gap-2 btn-system border border-transparent hover:border-blue-200 hover:shadow-sm" aria-label="Przejdź do sekcji O mnie" role="menuitem" data-section="about">
          <div class="w-4 h-4 rounded-lg bg-gradient-to-br from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 flex items-center justify-center transition-all duration-200 shadow-sm group-hover:shadow-md">
            <svg class="w-2.5 h-2.5 text-blue-600 group-hover:scale-110 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
          </div>
          <span>O mnie</span>
          <span class="sr-only">Dowiedz się więcej o mojej osobie i doświadczeniu</span>
        </a>
        
        <a href="#services" class="nav-link px-4 py-2.5 rounded-xl text-gray-700 hover:text-emerald-600 hover:bg-emerald-50 font-medium transition-all duration-200 flex items-center gap-2 btn-system border border-transparent hover:border-emerald-200 hover:shadow-sm" aria-label="Przejdź do sekcji Usługi" role="menuitem" data-section="services">
          <div class="w-4 h-4 rounded-lg bg-gradient-to-br from-emerald-50 to-emerald-100 hover:from-emerald-100 hover:to-emerald-200 flex items-center justify-center transition-all duration-200 shadow-sm group-hover:shadow-md">
            <svg class="w-2.5 h-2.5 text-emerald-600 group-hover:scale-110 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
          </div>
          <span>Usługi</span>
          <span class="sr-only">Zobacz jakie usługi oferuję</span>
        </a>
        
        <a href="#projects" class="nav-link px-4 py-2.5 rounded-xl text-gray-700 hover:text-purple-600 hover:bg-purple-50 font-medium transition-all duration-200 flex items-center gap-2 btn-system border border-transparent hover:border-purple-200 hover:shadow-sm" aria-label="Przejdź do sekcji Portfolio" role="menuitem" data-section="projects">
          <div class="w-4 h-4 rounded-lg bg-gradient-to-br from-purple-50 to-purple-100 hover:from-purple-100 hover:to-purple-200 flex items-center justify-center transition-all duration-200 shadow-sm group-hover:shadow-md">
            <svg class="w-2.5 h-2.5 text-purple-600 group-hover:scale-110 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2H5a2 2 0 00-2 2v2M7 7h10"/>
            </svg>
          </div>
          <span>Portfolio</span>
          <span class="sr-only">Zobacz moje najlepsze realizacje</span>
        </a>
        
        <!-- Separator -->
        <div class="h-6 w-px bg-gray-300 mx-3"></div>
        
        <!-- Clean Contact Button -->
        <a href="#contact" class="bg-gradient-to-r from-blue-500 to-purple-600 from-[-25%] to-125% text-white px-6 py-3 rounded-xl font-semibold transition-all duration-200 hover:shadow-lg hover:shadow-blue-600/30 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-2 flex items-center gap-2 group relative overflow-hidden" aria-label="Rozpocznij współpracę" role="menuitem">
          <!-- Subtle hover effect -->
          <div class="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-200"></div>
          
          <div class="p-1 bg-white/20 rounded-lg group-hover:bg-white/30 transition-colors duration-200 relative z-10">
            <svg class="w-3.5 h-3.5 group-hover:scale-110 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
          </div>
          <span class="relative z-10">Kontakt</span>
          <svg class="w-3 h-3 group-hover:translate-x-0.5 transition-transform duration-200 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <div class="lg:hidden">
        <button id="mobile-menu-button" class="relative text-gray-700 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-2 rounded-xl p-3 transition-colors duration-200 hover:bg-blue-50 active:scale-95" aria-label="Toggle menu nawigacji" aria-expanded="false" aria-haspopup="true" aria-controls="mobile-menu">
          <svg id="menu-icon" class="w-6 h-6 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
          <svg id="close-icon" class="absolute inset-3 w-6 h-6 transition-all duration-300 opacity-0 scale-90" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Simple Mobile Navigation -->
    <div id="mobile-menu" class="lg:hidden hidden absolute top-full left-0 right-0 bg-white border-t border-gray-200 shadow-lg" role="menu" aria-labelledby="mobile-menu-button">
      <div class="px-4 py-4 space-y-2">
        
        <a href="#about" class="mobile-nav-link block px-4 py-3 text-gray-700 hover:text-blue-600 hover:bg-blue-50 font-medium rounded-lg transition-colors duration-200" aria-label="Przejdź do sekcji O mnie" role="menuitem" data-section="about">
          <div class="flex items-center gap-3">
            <div class="w-6 h-6 bg-blue-100 rounded-md flex items-center justify-center flex-shrink-0">
              <svg class="w-3 h-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
              </svg>
            </div>
            <span>O mnie</span>
          </div>
        </a>
        
        <a href="#services" class="mobile-nav-link block px-4 py-3 text-gray-700 hover:text-emerald-600 hover:bg-emerald-50 font-medium rounded-lg transition-colors duration-200" aria-label="Przejdź do sekcji Usługi" role="menuitem" data-section="services">
          <div class="flex items-center gap-3">
            <div class="w-6 h-6 bg-emerald-100 rounded-md flex items-center justify-center flex-shrink-0">
              <svg class="w-3 h-3 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
              </svg>
            </div>
            <span>Usługi</span>
          </div>
        </a>
        
        <a href="#projects" class="mobile-nav-link block px-4 py-3 text-gray-700 hover:text-purple-600 hover:bg-purple-50 font-medium rounded-lg transition-colors duration-200" aria-label="Przejdź do sekcji Portfolio" role="menuitem" data-section="projects">
          <div class="flex items-center gap-3">
            <div class="w-6 h-6 bg-purple-100 rounded-md flex items-center justify-center flex-shrink-0">
              <svg class="w-3 h-3 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2H5a2 2 0 00-2 2v2M7 7h10"/>
              </svg>
            </div>
            <span>Portfolio</span>
          </div>
        </a>
        
        <div class="pt-2 mt-2 border-t border-gray-200">
          <a href="#contact" class="mobile-nav-link block bg-gradient-to-r from-blue-500 to-purple-600 text-white px-4 py-3 rounded-lg font-semibold transition-colors duration-200" aria-label="Rozpocznij współpracę" role="menuitem">
            <div class="flex items-center gap-3">
              <div class="w-6 h-6 bg-white/20 rounded-md flex items-center justify-center flex-shrink-0">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                </svg>
              </div>
              <span>Kontakt</span>
            </div>
          </a>
        </div>
        
      </div>
    </div>
  </div>
</nav>

<style>
  html {
    scroll-padding-top: 5rem;
    scroll-behavior: smooth;
  }

  /* Simplified glassmorphism navbar */
  .navbar-scrolled {
    background: rgba(255, 255, 255, 0.95) !important;
    backdrop-filter: blur(12px) !important;
    -webkit-backdrop-filter: blur(12px) !important;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
  }

  /* Clean Button System - Primary (CTA) */
  .btn-primary {
    position: relative;
    background: #2563eb;
    box-shadow: 
      0 4px 14px rgba(37, 99, 235, 0.25),
      0 2px 8px rgba(37, 99, 235, 0.15),
      0 1px 0 rgba(255, 255, 255, 0.2) inset;
    transition: all 0.2s ease;
  }

  .btn-primary:hover {
    background: #1d4ed8;
    transform: translateY(-2px);
    box-shadow: 
      0 6px 20px rgba(37, 99, 235, 0.35),
      0 4px 12px rgba(37, 99, 235, 0.25),
      0 1px 0 rgba(255, 255, 255, 0.3) inset;
  }

  .btn-primary:active {
    transform: translateY(0);
  }

  /* Simplified Button System - Secondary/System buttons */
  .btn-system {
    position: relative;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
  }

  .btn-system:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  /* Clean scroll progress indicator */
  #scroll-progress {
    background: linear-gradient(to right, #2563eb, #9333ea);
    transition: width 0.1s ease-out;
    border-radius: 2px;
    box-shadow: 0 0 8px rgba(37, 99, 235, 0.3);
  }

  /* Simplified active states */
  .nav-link.active {
    background: rgba(59, 130, 246, 0.1) !important;
    color: rgb(37, 99, 235) !important;
    border: 1px solid rgba(59, 130, 246, 0.2) !important;
  }

  .nav-link.active[href="#services"] {
    background: rgba(16, 185, 129, 0.1) !important;
    color: rgb(5, 150, 105) !important;
    border-color: rgba(16, 185, 129, 0.2) !important;
  }

  .nav-link.active[href="#projects"] {
    background: rgba(139, 92, 246, 0.1) !important;
    color: rgb(124, 58, 237) !important;
    border-color: rgba(139, 92, 246, 0.2) !important;
  }

  /* Enhanced mobile menu animations */
  #mobile-menu {
    transform: translateY(-20px);
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    max-height: 0;
    overflow: hidden;
  }

  #mobile-menu:not(.hidden) {
    transform: translateY(0);
    opacity: 1;
    visibility: visible;
    max-height: 500px;
  }

  /* Enhanced mobile menu button animations */
  #mobile-menu-button {
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  #mobile-menu-button:hover {
    transform: scale(1.05);
    background-color: rgba(59, 130, 246, 0.1);
  }

  #mobile-menu-button:active {
    transform: scale(0.95);
  }

  #mobile-menu-button[aria-expanded="true"] #menu-icon {
    opacity: 0;
    transform: rotate(180deg) scale(0.8);
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  #mobile-menu-button[aria-expanded="true"] #close-icon {
    opacity: 1;
    transform: rotate(0deg) scale(1);
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  #mobile-menu-button #menu-icon {
    opacity: 1;
    transform: rotate(0deg) scale(1);
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  #mobile-menu-button #close-icon {
    opacity: 0;
    transform: rotate(-180deg) scale(0.8);
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  /* Enhanced mobile nav link animations with stagger effect */
  .mobile-nav-link {
    transform: translateX(-30px);
    opacity: 0;
    transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    will-change: transform, opacity;
  }

  #mobile-menu:not(.hidden) .mobile-nav-link {
    transform: translateX(0);
    opacity: 1;
  }

  /* Staggered animation delays */
  #mobile-menu:not(.hidden) .mobile-nav-link:nth-child(1) { transition-delay: 0.1s; }
  #mobile-menu:not(.hidden) .mobile-nav-link:nth-child(2) { transition-delay: 0.2s; }
  #mobile-menu:not(.hidden) .mobile-nav-link:nth-child(3) { transition-delay: 0.3s; }
  #mobile-menu:not(.hidden) .mobile-nav-link:nth-child(5) { transition-delay: 0.4s; } /* CTA button */

  .mobile-nav-link:hover {
    transform: translateX(8px);
    background-color: rgba(59, 130, 246, 0.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .mobile-nav-link:active {
    transform: scale(0.95) translateX(4px);
    transition-duration: 0.1s;
  }

  /* Icon animations */
  .mobile-nav-link:hover .flex-shrink-0 {
    transform: scale(1.1) rotate(5deg);
    transition: transform 0.3s ease;
  }

  /* Gradient CTA button hover effect */
  .mobile-nav-link[href="#contact"]:hover {
    transform: translateX(8px) scale(1.02);
    box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
  }

  /* Additional mobile navigation enhancements */
  
  /* Smooth border animation */
  #mobile-menu {
    border-top: 2px solid rgba(59, 130, 246, 0);
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1), border-color 0.6s ease;
  }

  #mobile-menu:not(.hidden) {
    border-top-color: rgba(59, 130, 246, 0.2);
  }

  /* Opening and closing animations */
  #mobile-menu.opening {
    animation: menuSlideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  #mobile-menu.closing {
    animation: menuSlideOut 0.2s ease-in;
  }

  @keyframes menuSlideIn {
    0% {
      transform: translateY(-20px);
      opacity: 0;
    }
    100% {
      transform: translateY(0);
      opacity: 1;
    }
  }

  @keyframes menuSlideOut {
    0% {
      transform: translateY(0);
      opacity: 1;
    }
    100% {
      transform: translateY(-10px);
      opacity: 0;
    }
  }

  /* Interactive states for links */
  .mobile-nav-link.clicked {
    transform: scale(0.95) translateX(4px);
    background-color: rgba(59, 130, 246, 0.15);
  }

  .mobile-nav-link.hovered .flex-shrink-0 {
    transform: scale(1.15) rotate(10deg);
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  /* Background blur effect on mobile menu */
  #mobile-menu::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    z-index: -1;
    opacity: 0;
    transition: opacity 0.4s ease;
  }

  #mobile-menu:not(.hidden)::before {
    opacity: 1;
  }

  /* Pulse animation for active states */
  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

  .mobile-nav-link.active .flex-shrink-0 {
    animation: pulse 2s infinite;
  }

  /* Ripple effect on click */
  .mobile-nav-link {
    position: relative;
    overflow: hidden;
  }

  .mobile-nav-link::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(59, 130, 246, 0.2);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }

  .mobile-nav-link:active::after {
    width: 300px;
    height: 300px;
  }

  /* Smooth scaling for mobile menu container */
  #mobile-menu > div {
    transform: scale(0.95);
    transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  /* Focus improvements with animations */
  .nav-link:focus-visible,
  .mobile-nav-link:focus-visible,
  .btn-system:focus-visible,
  .btn-primary:focus-visible {
    outline: 2px solid #3b82f6;
    outline-offset: 3px;
    transform: scale(1.02);
    transition: all 0.3s ease;
  }

  .mobile-nav-link:focus-visible {
    background-color: rgba(59, 130, 246, 0.1);
    transform: translateX(4px) scale(1.02);
  }

  /* Reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    #mobile-menu,
    .mobile-nav-link,
    #mobile-menu-button svg,
    .mobile-nav-link .flex-shrink-0 {
      transition: none !important;
      animation: none !important;
      transform: none !important;
    }
    
    .mobile-nav-link:hover {
      transform: none !important;
    }
  }

  /* Performance optimizations */
  .nav-link,
  .mobile-nav-link,
  .btn-system,
  .btn-primary,
  #mobile-menu-button svg {
    will-change: transform;
  }

  /* GPU acceleration for smooth animations */
  .mobile-nav-link,
  #mobile-menu,
  #mobile-menu-button {
    transform: translateZ(0);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const navbar = document.getElementById('navbar');
    const navLinks = document.querySelectorAll('.nav-link');
    const scrollProgress = document.getElementById('scroll-progress');
    
    // Mobile menu toggle
    if (mobileMenuButton && mobileMenu) {
      mobileMenuButton.addEventListener('click', function() {
        const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
        
        if (isExpanded) {
          closeMobileMenu();
        } else {
          openMobileMenu();
        }
      });
    }
    
    function openMobileMenu() {
      mobileMenu?.classList.remove('hidden');
      mobileMenuButton?.setAttribute('aria-expanded', 'true');
      
      // Add opening class for additional effects
      mobileMenu?.classList.add('opening');
      
      // Focus first link with delay for staggered animation
      setTimeout(() => {
        const firstLink = mobileMenu?.querySelector('.mobile-nav-link') as HTMLElement;
        firstLink?.focus();
        // Remove opening class after animation completes
        mobileMenu?.classList.remove('opening');
      }, 200);
      
      // Add subtle vibration if available
      if ('vibrate' in navigator) {
        navigator.vibrate(10);
      }
    }
    
    function closeMobileMenu() {
      // Add closing animation
      mobileMenu?.classList.add('closing');
      
      setTimeout(() => {
        mobileMenu?.classList.add('hidden');
        mobileMenuButton?.setAttribute('aria-expanded', 'false');
        mobileMenuButton?.focus();
        mobileMenu?.classList.remove('closing');
      }, 200);
    }
    
    // Enhanced mobile menu link interactions
    document.querySelectorAll('.mobile-nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        // Add clicked class for animation
        link.classList.add('clicked');
        
        // Add haptic feedback
        if ('vibrate' in navigator) {
          navigator.vibrate(5);
        }
        
        // Remove clicked class after animation
        setTimeout(() => {
          link.classList.remove('clicked');
        }, 300);
        
        // Close menu with delay for smooth transition
        setTimeout(() => {
          closeMobileMenu();
        }, 150);
      });
      
      // Add mouseenter/mouseleave events for better hover effects
      link.addEventListener('mouseenter', () => {
        link.classList.add('hovered');
      });
      
      link.addEventListener('mouseleave', () => {
        link.classList.remove('hovered');
      });
    });
    
    // Close mobile menu on escape
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && !mobileMenu?.classList.contains('hidden')) {
        closeMobileMenu();
      }
    });
    
    // Close on scroll with improved UX
    window.addEventListener('scroll', () => {
      if (!mobileMenu?.classList.contains('hidden')) {
        closeMobileMenu();
      }
    }, { passive: true });
    
    // Enhanced navbar scroll effects with progress indicator
    let lastScrollY = window.scrollY;
    let ticking = false;
    
    function updateScrollProgress() {
      const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = Math.min(Math.max((winScroll / height) * 100, 0), 100);
      
      if (scrollProgress) {
        scrollProgress.style.width = scrolled + '%';
      }
    }
    
    function updateNavbar() {
      const currentScrollY = window.scrollY;
      
      if (navbar) {
        if (currentScrollY > 50) {
          navbar.classList.add('navbar-scrolled');
        } else {
          navbar.classList.remove('navbar-scrolled');
        }
      }
      
      updateScrollProgress();
      lastScrollY = currentScrollY;
      ticking = false;
    }
    
    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(updateNavbar);
        ticking = true;
      }
    }
    
    window.addEventListener('scroll', requestTick, { passive: true });
    
    // Enhanced active section highlighting
    const sections = Array.from(document.querySelectorAll('section[id]'));
    const navLinkMap = new Map();
    const mobileNavLinkMap = new Map();
    
    // Build nav link maps
    navLinks.forEach(link => {
      const href = link.getAttribute('href');
      if (href?.startsWith('#')) {
        const sectionId = href.substring(1);
        navLinkMap.set(sectionId, link);
      }
    });
    
    document.querySelectorAll('.mobile-nav-link[data-section]').forEach(link => {
      const sectionId = link.getAttribute('data-section');
      if (sectionId) {
        mobileNavLinkMap.set(sectionId, link);
      }
    });

    // Enhanced active link setting
    function setActiveLink(sectionId: string) {
      // Remove active from all links
      navLinks.forEach(link => link.classList.remove('active'));
      document.querySelectorAll('.mobile-nav-link').forEach(link => link.classList.remove('active'));
      
      // Add active to current section links
      const navLink = navLinkMap.get(sectionId);
      const mobileNavLink = mobileNavLinkMap.get(sectionId);
      
      navLink?.classList.add('active');
      mobileNavLink?.classList.add('active');
      
      // Update aria-current
      navLinks.forEach(link => link.removeAttribute('aria-current'));
      navLink?.setAttribute('aria-current', 'page');
    }

    // Enhanced IntersectionObserver with better thresholds
    let lastActiveId: string | null = null;
    const observerOptions = {
      root: null,
      rootMargin: '0px 0px -50% 0px',
      threshold: [0.1, 0.25, 0.5, 0.75]
    };
    
    const sectionObserver = new IntersectionObserver((entries) => {
      let maxRatio = 0;
      let activeId = null;
      
      entries.forEach(entry => {
        if (entry.isIntersecting && entry.intersectionRatio > maxRatio) {
          maxRatio = entry.intersectionRatio;
          activeId = entry.target.id;
        }
      });
      
      if (activeId && activeId !== lastActiveId) {
        setActiveLink(activeId);
        lastActiveId = activeId;
        
        // Announce section change for screen readers
        const announcement = `Przeszedłeś do sekcji ${activeId}`;
        announceToScreenReader(announcement);
      }
    }, observerOptions);
    
    sections.forEach(section => sectionObserver.observe(section));

    // Screen reader announcements
    function announceToScreenReader(message: string) {
      const announcement = document.createElement('div');
      announcement.setAttribute('aria-live', 'polite');
      announcement.setAttribute('aria-atomic', 'true');
      announcement.className = 'sr-only';
      announcement.textContent = message;
      
      document.body.appendChild(announcement);
      setTimeout(() => {
        document.body.removeChild(announcement);
      }, 1000);
    }

    // Enhanced smooth scroll with better offset calculation
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      const anchorElement = anchor as HTMLAnchorElement;
      anchorElement.addEventListener('click', function(e) {
        e.preventDefault();
        const href = anchorElement.getAttribute('href');
        if (href && href !== '#') {
          const target = document.getElementById(href.substring(1));
          if (target) {
            const navbarHeight = navbar?.offsetHeight || 64;
            const extraOffset = window.innerWidth < 768 ? 10 : 20; // Less offset on mobile
            const offsetTop = target.offsetTop - navbarHeight - extraOffset;
            
            window.scrollTo({
              top: Math.max(0, offsetTop),
              behavior: 'smooth'
            });
            
            // Update URL without triggering scroll
            if (history.pushState) {
              history.pushState(null, '', href);
            }
            
            // Focus target for accessibility
            setTimeout(() => {
              target.setAttribute('tabindex', '-1');
              target.focus();
              target.addEventListener('blur', () => target.removeAttribute('tabindex'), { once: true });
            }, 300);
          }
        }
      });
    });
    
    // Enhanced resize handler with mobile menu auto-close
    let resizeTimeout: NodeJS.Timeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        updateScrollProgress();
        // Close mobile menu on resize to desktop
        if (window.innerWidth >= 1024 && !mobileMenu?.classList.contains('hidden')) {
          closeMobileMenu();
        }
      }, 150);
    });
    
    // Initial setup
    updateNavbar();
    
    // Handle initial hash with improved timing
    if (window.location.hash) {
      setTimeout(() => {
        const target = document.getElementById(window.location.hash.substring(1));
        if (target) {
          const navbarHeight = navbar?.offsetHeight || 64;
          const offsetTop = target.offsetTop - navbarHeight - 20;
          window.scrollTo({ 
            top: Math.max(0, offsetTop), 
            behavior: 'smooth' 
          });
        }
      }, 250);
    }
    
    // Keyboard navigation enhancement
    document.addEventListener('keydown', (e) => {
      // Alt + N for navigation focus
      if (e.altKey && e.key.toLowerCase() === 'n') {
        e.preventDefault();
        const firstNavLink = document.querySelector('.nav-link') as HTMLElement;
        firstNavLink?.focus();
        announceToScreenReader('Nawigacja aktywowana');
      }
    });
    
    // Preload sections on hover (performance enhancement)
    navLinks.forEach(link => {
      link.addEventListener('mouseenter', () => {
        const href = link.getAttribute('href');
        if (href?.startsWith('#')) {
          const target = document.getElementById(href.substring(1));
          if (target && !target.hasAttribute('data-preloaded')) {
            target.setAttribute('data-preloaded', 'true');
            // Trigger any lazy loading in the section
            const lazyElements = target.querySelectorAll('[data-lazy]');
            lazyElements.forEach(el => {
              const src = el.getAttribute('data-lazy');
              if (src) {
                el.setAttribute('src', src);
                el.removeAttribute('data-lazy');
              }
            });
          }
        }
      });
    });
  });
</script>

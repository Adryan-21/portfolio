---
// Enhanced Navigation component with premium UX and modern styling
---

<nav class="fixed top-0 left-0 right-0 bg-white/70 backdrop-blur-xl border-b border-white/20 z-50 transition-all duration-500 shadow-lg shadow-black/5" id="navbar">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16 lg:h-20">
      
      <!-- Enhanced Logo with micro-interactions -->
      <a href="#hero" class="flex items-center group hover:scale-105 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-xl p-2 -m-2" aria-label="Przejdź do strony głównej">
        <div class="relative w-11 h-11 bg-gradient-to-tr from-blue-500 via-indigo-500 to-purple-600 rounded-xl flex items-center justify-center mr-3 shadow-lg group-hover:shadow-2xl group-hover:shadow-blue-500/25 transition-all duration-500 overflow-hidden">
          <span class="text-white font-bold text-lg z-10 relative">AD</span>
          <div class="absolute inset-0 bg-gradient-to-tr from-blue-400 via-indigo-400 to-purple-500 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
          <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl opacity-0 group-hover:opacity-20 blur transition-all duration-500"></div>
        </div>
        <div class="flex flex-col">
          <span class="font-bold text-gray-900 text-lg tracking-tight group-hover:text-blue-600 transition-colors duration-300">Adrian</span>
          <span class="text-xs text-gray-500 font-medium -mt-0.5 group-hover:text-blue-500 transition-colors duration-300">Frontend Developer</span>
        </div>
      </a>

      <!-- Premium Desktop Navigation -->
      <div class="hidden lg:flex items-center space-x-2">
        <a href="#about" class="nav-link group relative px-5 py-2.5 rounded-xl text-gray-700 hover:text-blue-600 font-medium transition-all duration-300 overflow-hidden" aria-label="Przejdź do sekcji O mnie">
          <span class="relative z-10 flex items-center gap-2">
            <svg class="w-4 h-4 opacity-0 group-hover:opacity-100 transition-all duration-300 -translate-x-2 group-hover:translate-x-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
            O mnie
          </span>
          <div class="absolute inset-0 bg-gradient-to-r from-blue-50 to-indigo-50 scale-0 group-hover:scale-100 transition-transform duration-300 rounded-xl"></div>
          <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-0 h-0.5 bg-gradient-to-r from-blue-500 to-indigo-500 group-hover:w-full transition-all duration-300"></div>
        </a>
        <a href="#services" class="nav-link group relative px-5 py-2.5 rounded-xl text-gray-700 hover:text-blue-600 font-medium transition-all duration-300 overflow-hidden" aria-label="Przejdź do sekcji Usługi">
          <span class="relative z-10 flex items-center gap-2">
            <svg class="w-4 h-4 opacity-0 group-hover:opacity-100 transition-all duration-300 -translate-x-2 group-hover:translate-x-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
            Usługi
          </span>
          <div class="absolute inset-0 bg-gradient-to-r from-blue-50 to-indigo-50 scale-0 group-hover:scale-100 transition-transform duration-300 rounded-xl"></div>
          <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-0 h-0.5 bg-gradient-to-r from-blue-500 to-indigo-500 group-hover:w-full transition-all duration-300"></div>
        </a>
        <a href="#projects" class="nav-link group relative px-5 py-2.5 rounded-xl text-gray-700 hover:text-blue-600 font-medium transition-all duration-300 overflow-hidden" aria-label="Przejdź do sekcji Portfolio">
          <span class="relative z-10 flex items-center gap-2">
            <svg class="w-4 h-4 opacity-0 group-hover:opacity-100 transition-all duration-300 -translate-x-2 group-hover:translate-x-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
            </svg>
            Portfolio
          </span>
          <div class="absolute inset-0 bg-gradient-to-r from-blue-50 to-indigo-50 scale-0 group-hover:scale-100 transition-transform duration-300 rounded-xl"></div>
          <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-0 h-0.5 bg-gradient-to-r from-blue-500 to-indigo-500 group-hover:w-full transition-all duration-300"></div>
        </a>
        
        <!-- Elegant separator -->
        <div class="h-8 w-px bg-gradient-to-b from-transparent via-gray-200 to-transparent mx-3"></div>
        
        <!-- Premium CTA Button -->
        <a href="#contact" class="relative group bg-gradient-to-r from-blue-600 via-indigo-600 to-blue-700 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:via-indigo-700 hover:to-blue-800 font-semibold transition-all duration-300 shadow-lg shadow-blue-500/25 hover:shadow-xl hover:shadow-blue-500/40 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 overflow-hidden" aria-label="Rozpocznij współpracę">
          <span class="relative z-10 flex items-center gap-2">
            <svg class="w-4 h-4 transition-transform duration-300 group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
            Porozmawiajmy
          </span>
          <div class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/10 to-white/0 -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"></div>
        </a>
      </div>

      <!-- Enhanced Mobile Menu Button -->
      <div class="lg:hidden">
        <button id="mobile-menu-button" class="relative text-gray-700 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-xl p-3 transition-all duration-300 hover:bg-blue-50" aria-label="Toggle menu nawigacji" aria-expanded="false">
          <div class="relative w-6 h-6">
            <svg id="menu-icon" class="absolute inset-0 w-6 h-6 transition-all duration-300 rotate-0 opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
            <svg id="close-icon" class="absolute inset-0 w-6 h-6 transition-all duration-300 rotate-180 opacity-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </div>
          <div class="absolute inset-0 bg-blue-100 rounded-xl opacity-0 transition-opacity duration-300 hover:opacity-100"></div>
        </button>
      </div>

    </div>

    <!-- Premium Mobile Navigation -->
    <div id="mobile-menu" class="lg:hidden hidden">
      <div class="absolute left-0 right-0 top-full bg-white/95 backdrop-blur-xl border-t border-white/20 shadow-2xl shadow-black/10">
        <div class="px-6 py-6 space-y-2 max-h-[80vh] overflow-y-auto">
          <!-- Mobile nav items with enhanced UX -->
          <a href="#about" class="mobile-nav-link group block px-5 py-4 text-gray-700 hover:text-blue-600 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 font-medium rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" aria-label="Przejdź do sekcji O mnie">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center group-hover:bg-blue-200 transition-colors duration-300">
                  <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                </div>
                <div>
                  <span class="block font-medium">O mnie</span>
                  <span class="text-sm text-gray-500 group-hover:text-blue-500 transition-colors duration-300">Poznaj mnie bliżej</span>
                </div>
              </div>
              <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </div>
          </a>
          
          <a href="#services" class="mobile-nav-link group block px-5 py-4 text-gray-700 hover:text-blue-600 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 font-medium rounded-xl transition-all duration-300  focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" aria-label="Przejdź do sekcji Usługi">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center group-hover:bg-indigo-200 transition-colors duration-300">
                  <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                  </svg>
                </div>
                <div>
                  <span class="block font-medium">Usługi</span>
                  <span class="text-sm text-gray-500 group-hover:text-blue-500 transition-colors duration-300">Co oferuję</span>
                </div>
              </div>
              <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </div>
          </a>
          
          <a href="#projects" class="mobile-nav-link group block px-5 py-4 text-gray-700 hover:text-blue-600 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 font-medium rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" aria-label="Przejdź do sekcji Portfolio">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center group-hover:bg-purple-200 transition-colors duration-300">
                  <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                  </svg>
                </div>
                <div>
                  <span class="block font-medium">Portfolio</span>
                  <span class="text-sm text-gray-500 group-hover:text-blue-500 transition-colors duration-300">Moje realizacje</span>
                </div>
              </div>
              <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </div>
          </a>
          
          <!-- Enhanced separator -->
          <div class="flex items-center py-3">
            <div class="flex-1 h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent"></div>
            <span class="px-4 text-xs text-gray-400 font-medium">KONTAKT</span>
            <div class="flex-1 h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent"></div>
          </div>
          
          <!-- Premium mobile CTA -->
          <a href="#contact" class="mobile-nav-link group relative block bg-gradient-to-r from-blue-600 via-indigo-600 to-blue-700 text-white px-5 py-4 rounded-xl font-semibold transition-all duration-300 shadow-lg shadow-blue-500/25 hover:shadow-xl hover:shadow-blue-500/40 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 overflow-hidden" aria-label="Rozpocznij współpracę">
            <div class="relative z-10 flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                  </svg>
                </div>
                <div>
                  <span class="block font-semibold">Porozmawiajmy</span>
                  <span class="text-sm text-blue-100">Bezpłatna konsultacja</span>
                </div>
              </div>
              <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
              </svg>
            </div>
            <div class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/10 to-white/0 -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"></div>
          </a>
          
          <!-- Quick contact info -->
          <div class="pt-4 border-t border-gray-100 mt-4">
            <p class="text-center text-sm text-gray-500">
              📧 <span class="font-medium text-gray-700">hello@adrian.dev</span>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Premium Navigation Styles with Advanced UX -->
<style>
  html {
    scroll-padding-top: 6rem;
    scroll-behavior: smooth;
  }

  /* Premium navbar scroll effects */
  .navbar-scrolled {
    background-color: rgba(255, 255, 255, 0.7) !important;
    backdrop-filter: blur(20px) !important;
    border-bottom-color: rgba(255, 255, 255, 0.3) !important;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12), 0 2px 6px rgba(0, 0, 0, 0.08) !important;
  }

  /* Active navigation states with premium styling */
  .nav-link.active {
    color: rgb(37 99 235) !important;
    background: linear-gradient(135deg, rgb(239 246 255), rgb(224 242 254)) !important;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
  }

  .nav-link.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, rgb(59 130 246), rgb(99 102 241));
    border-radius: 1px;
  }

  /* Enhanced mobile menu animations */
  #mobile-menu {
    transform: translateY(-20px) scale(0.95);
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  #mobile-menu:not(.hidden) {
    transform: translateY(0) scale(1);
    opacity: 1;
  }

  /* Advanced mobile menu button animations */
  #mobile-menu-button[aria-expanded="true"] #menu-icon {
    opacity: 0;
    transform: rotate(90deg) scale(0.8);
  }

  #mobile-menu-button[aria-expanded="true"] #close-icon {
    opacity: 1;
    transform: rotate(0deg) scale(1);
  }

  #mobile-menu-button[aria-expanded="false"] #menu-icon {
    opacity: 1;
    transform: rotate(0deg) scale(1);
  }

  #mobile-menu-button[aria-expanded="false"] #close-icon {
    opacity: 0;
    transform: rotate(-90deg) scale(0.8);
  }

  /* Staggered mobile navigation animations */
  .mobile-nav-link {
    transform: translateX(-30px);
    opacity: 0;
    animation: slideInFromLeft 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  }

  .mobile-nav-link:nth-child(1) { animation-delay: 0.1s; }
  .mobile-nav-link:nth-child(2) { animation-delay: 0.15s; }
  .mobile-nav-link:nth-child(3) { animation-delay: 0.2s; }
  .mobile-nav-link:nth-child(5) { animation-delay: 0.25s; }
  .mobile-nav-link:nth-child(6) { animation-delay: 0.3s; }

  @keyframes slideInFromLeft {
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  /* Premium logo animations */
  @keyframes logoGlow {
    0%, 100% {
      box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.25),
                  0 0 0 1px rgba(59, 130, 246, 0.05);
    }
    50% {
      box-shadow: 0 20px 40px -5px rgba(59, 130, 246, 0.4),
                  0 0 0 1px rgba(59, 130, 246, 0.1);
    }
  }

  /* Enhanced focus states for accessibility */
  .nav-link:focus-visible,
  .mobile-nav-link:focus-visible {
    outline: 2px solid rgb(59 130 246);
    outline-offset: 4px;
    border-radius: 8px;
  }

  /* Smooth hover transitions for desktop nav links */
  .nav-link:hover {
    transform: translateY(-2px);
  }

  /* Mobile menu backdrop */
  #mobile-menu::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(2px);
    z-index: -1;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  #mobile-menu:not(.hidden)::before {
    opacity: 1;
  }

  /* Advanced gradient animations */
  @keyframes gradientShift {
    0%, 100% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
  }

  /* Premium scroll progress indicator */
  .scroll-progress {
    position: fixed;
    top: 0;
    left: 0;
    width: 0%;
    height: 3px;
    background: linear-gradient(90deg, rgb(59 130 246), rgb(99 102 241), rgb(139 92 246));
    z-index: 9999;
    transition: width 0.3s ease;
  }

  /* Microinteractions for better UX */
  .nav-link,
  .mobile-nav-link {
    position: relative;
    overflow: hidden;
  }

  .nav-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    transition: left 0.5s ease;
  }

  .nav-link:hover::before {
    left: 100%;
  }

  /* Responsive typography adjustments */
  @media (max-width: 640px) {
    .nav-logo-text {
      font-size: 0.95rem;
    }
    
    #mobile-menu {
      max-height: calc(100vh - 80px);
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .nav-link,
    .mobile-nav-link {
      border: 1px solid currentColor;
    }
    
    .navbar-scrolled {
      border-bottom-width: 2px !important;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .nav-link,
    .mobile-nav-link,
    #mobile-menu,
    #menu-icon,
    #close-icon {
      transition: none !important;
      animation: none !important;
    }
    
    html {
      scroll-behavior: auto;
    }
  }

  
</style>

<script>
  // Enhanced navigation with premium UX and performance optimizations
  document.addEventListener('DOMContentLoaded', function() {
    // Cache DOM elements for better performance
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');
    const navbar = document.getElementById('navbar');
    const navLinks = document.querySelectorAll('.nav-link');
    const mobileLinks = document.querySelectorAll('.mobile-nav-link');
    
    // Create scroll progress indicator
    const scrollProgress = document.createElement('div');
    scrollProgress.className = 'scroll-progress';
    document.body.appendChild(scrollProgress);
    
    // Enhanced mobile menu toggle with improved accessibility
    if (mobileMenuButton && mobileMenu) {
      mobileMenuButton.addEventListener('click', function(e) {
        e.preventDefault();
        const isHidden = mobileMenu.classList.contains('hidden');
        const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
        
        if (isHidden || !isExpanded) {
          openMobileMenu();
        } else {
          closeMobileMenu();
        }
      });
    }
    
    function openMobileMenu() {
      mobileMenu?.classList.remove('hidden');
      mobileMenuButton?.setAttribute('aria-expanded', 'true');
      document.body.style.overflow = 'hidden';
      
      // Add escape key listener
      document.addEventListener('keydown', handleEscapeKey);
      
      // Focus management for accessibility
      setTimeout(() => {
        const firstLink = mobileMenu?.querySelector('.mobile-nav-link') as HTMLElement;
        firstLink?.focus();
      }, 100);
      
      // Add backdrop click listener
      setTimeout(() => {
        document.addEventListener('click', handleBackdropClick);
      }, 100);
    }
    
    function closeMobileMenu() {
      mobileMenu?.classList.add('hidden');
      mobileMenuButton?.setAttribute('aria-expanded', 'false');
      document.body.style.overflow = '';
      
      // Remove event listeners
      document.removeEventListener('keydown', handleEscapeKey);
      document.removeEventListener('click', handleBackdropClick);
      
      // Return focus to menu button
      mobileMenuButton?.focus();
    }
    
    function handleEscapeKey(event: KeyboardEvent) {
      if (event.key === 'Escape') {
        closeMobileMenu();
      }
    }
    
    function handleBackdropClick(event: MouseEvent) {
      const target = event.target as Element;
      const isClickInsideNav = mobileMenuButton?.contains(target) || mobileMenu?.contains(target);
      if (!isClickInsideNav) {
        closeMobileMenu();
      }
    }
    
    // Close mobile menu when clicking on any link
    mobileLinks?.forEach(link => {
      link.addEventListener('click', function(e) {
        // Add smooth closing animation delay
        setTimeout(() => {
          closeMobileMenu();
        }, 150);
      });
    });
    
    // Advanced navbar scroll effects with performance optimization
    let lastScrollY = window.scrollY;
    let ticking = false;
    
    function updateNavbar() {
      const currentScrollY = window.scrollY;
      const scrollPercent = (currentScrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
      
      // Update scroll progress
      if (scrollProgress) {
        scrollProgress.style.width = `${Math.min(scrollPercent, 100)}%`;
      }
      
      // Navbar scroll effects
      if (navbar) {
        if (currentScrollY > 80) {
          navbar.classList.add('navbar-scrolled');
        } else {
          navbar.classList.remove('navbar-scrolled');
        }
        
        // Hide/show navbar on scroll direction (optional premium feature)
        if (currentScrollY > lastScrollY + 10 && currentScrollY > 200) {
          navbar.style.transform = 'translateY(-100%)';
        } else if (currentScrollY < lastScrollY - 10 || currentScrollY < 200) {
          navbar.style.transform = 'translateY(0)';
        }
      }
      
      lastScrollY = currentScrollY;
      ticking = false;
    }
    
    function requestNavbarUpdate() {
      if (!ticking) {
        requestAnimationFrame(updateNavbar);
        ticking = true;
      }
    }

    window.addEventListener('scroll', requestNavbarUpdate, { passive: true });

    // Enhanced active section highlighting with intersection observer
    const sections = document.querySelectorAll('section[id]');
    const navLinkMap = new Map();
    
    // Create mapping of sections to nav links
    navLinks.forEach(link => {
      const href = link.getAttribute('href');
      if (href?.startsWith('#')) {
        const sectionId = href.substring(1);
        navLinkMap.set(sectionId, link);
      }
    });
    
    // Intersection Observer for active section detection
    const observerOptions = {
      root: null,
      rootMargin: '-20% 0px -70% 0px',
      threshold: [0, 0.25, 0.5, 0.75, 1]
    };
    
    const sectionObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        const sectionId = entry.target.id;
        const navLink = navLinkMap.get(sectionId);
        
        if (entry.isIntersecting) {
          // Remove active class from all links
          navLinks.forEach(link => link.classList.remove('active'));
          // Add active class to current section link
          navLink?.classList.add('active');
        }
      });
    }, observerOptions);
    
    // Observe all sections
    sections.forEach(section => {
      sectionObserver.observe(section);
    });

    // Enhanced smooth scroll with offset calculation
    function smoothScrollToSection(targetId: string) {
      const target = document.getElementById(targetId);
      if (target) {
        const navbarHeight = navbar?.offsetHeight || 80;
        const offsetTop = target.offsetTop - navbarHeight - 20;
        
        window.scrollTo({
          top: offsetTop,
          behavior: 'smooth'
        });
      }
    }
    
    // Add smooth scroll to all navigation links
    document.querySelectorAll('a[href^="#"]').forEach((anchor: Element) => {
      const anchorElement = anchor as HTMLAnchorElement;
      anchorElement.addEventListener('click', function (e: Event) {
        e.preventDefault();
        const href = anchorElement.getAttribute('href');
        if (href && href !== '#') {
          const targetId = href.substring(1);
          smoothScrollToSection(targetId);
          
          // Update URL without triggering scroll
          if (history.pushState) {
            history.pushState(null, '', href);
          }
        }
      });
    });
    
    // Keyboard navigation support
    navLinks.forEach((link, index) => {
      link.addEventListener('keydown', function(e) {
        const keyEvent = e as KeyboardEvent;
        if (keyEvent.key === 'ArrowRight' || keyEvent.key === 'ArrowDown') {
          keyEvent.preventDefault();
          const nextIndex = (index + 1) % navLinks.length;
          (navLinks[nextIndex] as HTMLElement).focus();
        } else if (keyEvent.key === 'ArrowLeft' || keyEvent.key === 'ArrowUp') {
          keyEvent.preventDefault();
          const prevIndex = (index - 1 + navLinks.length) % navLinks.length;
          (navLinks[prevIndex] as HTMLElement).focus();
        }
      });
    });
    
    // Mobile keyboard navigation
    mobileLinks.forEach((link, index) => {
      link.addEventListener('keydown', function(e) {
        const keyEvent = e as KeyboardEvent;
        if (keyEvent.key === 'ArrowDown') {
          keyEvent.preventDefault();
          const nextIndex = (index + 1) % mobileLinks.length;
          (mobileLinks[nextIndex] as HTMLElement).focus();
        } else if (keyEvent.key === 'ArrowUp') {
          keyEvent.preventDefault();
          const prevIndex = (index - 1 + mobileLinks.length) % mobileLinks.length;
          (mobileLinks[prevIndex] as HTMLElement).focus();
        }
      });
    });
    
    // Performance optimization: Preload sections on hover
    navLinks.forEach(link => {
      link.addEventListener('mouseenter', function() {
        const href = link.getAttribute('href');
        if (href?.startsWith('#')) {
          const targetId = href.substring(1);
          const target = document.getElementById(targetId);
          if (target) {
            // Trigger any lazy loading in the target section
            target.classList.add('section-hovered');
          }
        }
      });
    });
    
    // Handle browser back/forward navigation
    window.addEventListener('popstate', function() {
      const hash = window.location.hash;
      if (hash) {
        const targetId = hash.substring(1);
        smoothScrollToSection(targetId);
      }
    });
    
    // Initial setup
    updateNavbar();
    
    // Handle hash in URL on page load
    if (window.location.hash) {
      setTimeout(() => {
        const targetId = window.location.hash.substring(1);
        smoothScrollToSection(targetId);
      }, 100);
    }
    
    // Add loading state management
    window.addEventListener('beforeunload', function() {
      navbar?.classList.add('nav-loading');
    });
    
    // Cleanup on page unload
    window.addEventListener('beforeunload', function() {
      sectionObserver.disconnect();
      document.removeEventListener('keydown', handleEscapeKey);
      document.removeEventListener('click', handleBackdropClick);
    });
  });
</script>
